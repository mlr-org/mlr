<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use case gstat • mlr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Use case gstat">
<meta property="og:description" content="">
<meta property="og:image" content="https://mlr-org.github.io/mlr/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link rel="icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
<link rel="apple-touch-icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html"></a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/mlr.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/task.html">Tasks</a>
    </li>
    <li>
      <a href="../articles/learner.html">Learners</a>
    </li>
    <li>
      <a href="../articles/train.html">Train</a>
    </li>
    <li>
      <a href="../articles/predict.html">Predict</a>
    </li>
    <li>
      <a href="../articles/preproc.html">Preprocessing</a>
    </li>
    <li>
      <a href="../articles/performance.html">Performance</a>
    </li>
    <li>
      <a href="../articles/resample.html">Resampling</a>
    </li>
    <li>
      <a href="../articles/tune.html">Tuning</a>
    </li>
    <li>
      <a href="../articles/benchmark_experiments.html">Benchmark Experiments</a>
    </li>
    <li>
      <a href="../articles/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../articles/visualization.html">Visualization</a>
    </li>
    <li>
      <a href="../articles/usecase_regression.html">Use case - Regression</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/configureMlr.html">Configuration</a>
    </li>
    <li>
      <a href="../articles/wrapper.html">Wrapped Learners</a>
    </li>
    <li>
      <a href="../articles/impute.html">Imputation</a>
    </li>
    <li>
      <a href="../articles/bagging.html">Generic Bagging</a>
    </li>
    <li>
      <a href="../articles/advanced_tune.html">Advanced Tuning</a>
    </li>
    <li>
      <a href="../articles/feature_selection.html">Feature Selection</a>
    </li>
    <li>
      <a href="../articles/nested_resampling.html">Nested Resampling</a>
    </li>
    <li>
      <a href="../articles/cost_sensitive_classif.html">Cost-Sensitive Classification</a>
    </li>
    <li>
      <a href="../articles/over_and_undersampling.html">Imbalanced Classification Problems</a>
    </li>
    <li>
      <a href="../articles/roc_analysis.html">ROC Analysis and Performance Curves</a>
    </li>
    <li>
      <a href="../articles/multilabel.html">Multilabel Classification</a>
    </li>
    <li>
      <a href="../articles/learning_curve.html">Learning Curve Analysis</a>
    </li>
    <li>
      <a href="../articles/partial_dependence.html">Partial Dependence Plots</a>
    </li>
    <li>
      <a href="../articles/classifier_calibration.html">Classifier Calibration</a>
    </li>
    <li>
      <a href="../articles/hyperpar_tuning_effects.html">Hyperparameter Tuning Effects</a>
    </li>
    <li>
      <a href="../articles/out_of_bag_predictions.html">Out-of-Bag Predictions</a>
    </li>
    <li>
      <a href="../articles/handling_of_spatial_data.html">Handling of Spatial Data</a>
    </li>
    <li>
      <a href="../articles/functional_data.html">Functional Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extending
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/create_learner.html">Create Custom Learners</a>
    </li>
    <li>
      <a href="../articles/create_measure.html">Create Custom Measures</a>
    </li>
    <li>
      <a href="../articles/create_imputation.html">Create Imputation Methods</a>
    </li>
    <li>
      <a href="../articles/create_filter.html">Create Custom Filters</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Function Reference</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
    <li>
      <a href="../articles/example_tasks.html">Example Tasks</a>
    </li>
    <li>
      <a href="../articles/integrated_learners.html">Integrated Learners</a>
    </li>
    <li>
      <a href="../articles/measures.html">Implemented Measures</a>
    </li>
    <li>
      <a href="../articles/filter_methods.html">Integrated Filter Methods</a>
    </li>
    <li>
      <a href="../articles/mlr_publications.html">mlr Publications</a>
    </li>
    <li>
      <a href="../articles/talks_videos_workshops.html">Talks, Videos and Workshops</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    mlr-org Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://github.com/mlr-org/mlrMBO">mlrMBO</a>
    </li>
    <li>
      <a href="https://github.com/mlr-org/mlrng">mlrng</a>
    </li>
    <li>
      <a href="https://github.com/mlr-org/mlrCPO">mlrCPO</a>
    </li>
    <li>
      <a href="https://github.com/mlr-org/shinyMlr">shinyMlr</a>
    </li>
    <li>
      <a href="http://jakob-r.de/mlrHyperopt/index.html">mlrHyperopt</a>
    </li>
    <li>
      <a href="http://openml.github.io/openml-r/vignettes/OpenML.html">OpenML</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fa fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fa fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.github.io">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Use case gstat</h1>
                        <h4 class="author">Thomas Goossens (<span class="citation">@pokyah</span>)</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr/blob/master/vignettes/usecase_gstat.Rmd"><code>vignettes/usecase_gstat.Rmd</code></a></small>
      <div class="hidden name"><code>usecase_gstat.Rmd</code></div>

    </div>

    
    
<p>For the gstat use case we use the well-known <code>meuse</code> and <code>meuse.grid</code> datasets from <a href="https://cran.r-project.org/web/packages/sp/index.html">sp</a> package.</p>
<p>The purpose of this vignette is to demonstrate how to use gstat spatial prediction functionalities from the mlr interface.</p>
<p>Original gstat code will be presented with its mlr counterpart for various spatial prediction methods (Inverse Distance Weighted, trend surfaces, ordinaray kriging and kriging with external drift).</p>
<p>The examples presented in this vignette are inspired by the examples provided in the gstat <a href="https://cran.r-project.org/web/packages/gstat/vignettes/gstat.pdf">vignette</a></p>
<p>First, let’s prepare the required libraries</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gstat)
<span class="kw">library</span>(sp)
<span class="kw">library</span>(mlr)
<span class="kw">library</span>(dplyr)</code></pre></div>
<div id="inverse-distance-weighted" class="section level2">
<h2 class="hasAnchor">
<a href="#inverse-distance-weighted" class="anchor"></a>Inverse distance Weighted</h2>
<p>Here is the code using pure <strong>gstat</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># interpolating</span>
zinc.idw =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/krige">idw</a></span>(zinc<span class="op">~</span><span class="dv">1</span>, meuse, meuse.grid)
## [inverse distance weighted interpolation]
<span class="co"># mapping</span>
idw.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(zinc.idw[<span class="st">"var1.pred"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>,  <span class="dt">main =</span> <span class="st">"zn : idw interpoaltion (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="../reference/Task.html">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"zinc"</span>)
task.idw =<span class="st"> </span><span class="kw"><a href="../reference/dropFeatures.html">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="../reference/getTaskFeatureNames.html">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])
<span class="co"># defining the learner</span>
lrn.idw =<span class="st"> </span><span class="kw"><a href="../reference/makeLearner.html">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-idw"</span>, <span class="dt">locations =</span> <span class="op">~</span>x<span class="op">+</span>y)
<span class="co"># training the model</span>
mod.idw =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(lrn.idw, task.idw)
<span class="co"># interpolating</span>
newdata.pred.idw =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.idw, <span class="dt">newdata =</span> meuse.grid)
mlr.idw =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), newdata.pred.idw<span class="op">$</span>data)
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(mlr.idw) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(mlr.idw) =<span class="st"> </span><span class="ot">TRUE</span>
idw.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(mlr.idw[<span class="st">"response"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"zn : idw interpoaltion (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="usecase_gstat_files/figure-html/idw_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(zinc.idw[<span class="st">"var1.pred"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]], mlr.idw[<span class="st">"response"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]])
## [1] TRUE</code></pre></div>
</div>
<div id="trend-surfaces-interpolation-" class="section level2">
<h2 class="hasAnchor">
<a href="#trend-surfaces-interpolation-" class="anchor"></a>Trend surfaces interpolation.</h2>
<p>Here is the code using pure <strong>gstat</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data (using mlr::imput)</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># interpolating</span>
ts.gstat =<span class="st"> </span>meuse.grid
ts.gstat<span class="op">$</span>ts1 =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">degree =</span> <span class="dv">1</span>)<span class="op">$</span>var1.pred
## [ordinary or weighted least squares prediction]
ts.gstat<span class="op">$</span>ts2 =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">degree =</span> <span class="dv">2</span>)<span class="op">$</span>var1.pred
## [ordinary or weighted least squares prediction]
ts.gstat<span class="op">$</span>ts3 =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">degree =</span> <span class="dv">3</span>)<span class="op">$</span>var1.pred
## [ordinary or weighted least squares prediction]
<span class="co"># mapping</span>
ts.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ts.gstat, <span class="kw">c</span>(<span class="st">"ts1"</span>, <span class="st">"ts2"</span>, <span class="st">"ts3"</span>), <span class="dt">main =</span> <span class="st">"log(zn) : ts interpolation (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># adding a column with log zinc</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">log_zinc =</span> <span class="kw">log</span>(zinc))
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="../reference/Task.html">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"log_zinc"</span>)
task.ts =<span class="st"> </span><span class="kw"><a href="../reference/dropFeatures.html">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="../reference/getTaskFeatureNames.html">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])
<span class="co"># defining the learner</span>
lrn.ts.<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="../reference/makeLearner.html">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-ts1"</span>, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">locations =</span> <span class="op">~</span>x<span class="op">+</span>y)
lrn.ts.<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="../reference/makeLearner.html">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-ts2"</span>, <span class="dt">degree =</span> <span class="dv">2</span>, <span class="dt">locations =</span> <span class="op">~</span>x<span class="op">+</span>y)
lrn.ts.<span class="dv">3</span> =<span class="st"> </span><span class="kw"><a href="../reference/makeLearner.html">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-ts3"</span>, <span class="dt">degree =</span> <span class="dv">3</span>, <span class="dt">locations =</span> <span class="op">~</span>x<span class="op">+</span>y)
<span class="co"># training the learners</span>
mod.ts.<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(lrn.ts.<span class="dv">1</span>, task.ts)
mod.ts.<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(lrn.ts.<span class="dv">2</span>, task.ts)
mod.ts.<span class="dv">3</span> =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(lrn.ts.<span class="dv">3</span>, task.ts)
<span class="co"># interpolating</span>
ts.mlr =<span class="st"> </span>meuse.grid
newdata.pred.ts.<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.ts.<span class="dv">1</span>, <span class="dt">newdata =</span> meuse.grid)
ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">1</span> =<span class="st"> </span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), newdata.pred.ts.<span class="dv">1</span><span class="op">$</span>data))<span class="op">$</span>response
newdata.pred.ts.<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.ts.<span class="dv">2</span>, <span class="dt">newdata =</span> meuse.grid)
ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">2</span> =<span class="st"> </span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), newdata.pred.ts.<span class="dv">2</span><span class="op">$</span>data))<span class="op">$</span>response
newdata.pred.ts.<span class="dv">3</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.ts.<span class="dv">3</span>, <span class="dt">newdata =</span> meuse.grid)
ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">3</span> =<span class="st"> </span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), newdata.pred.ts.<span class="dv">3</span><span class="op">$</span>data))<span class="op">$</span>response
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ts.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ts.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ts.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ts.mlr, <span class="kw">c</span>(<span class="st">"mlr.ts.1"</span>, <span class="st">"mlr.ts.2"</span>, <span class="st">"mlr.ts.3"</span>), <span class="dt">main =</span> <span class="st">"log(zn) : ts interpolation (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="usecase_gstat_files/figure-html/ts_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">1</span>, ts.gstat<span class="op">$</span>ts1)
## [1] TRUE
<span class="kw">identical</span>(ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">2</span>, ts.gstat<span class="op">$</span>ts2)
## [1] TRUE
<span class="kw">identical</span>(ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">3</span>, ts.gstat<span class="op">$</span>ts3)
## [1] TRUE</code></pre></div>
</div>
<div id="ordinary-kriging-example" class="section level2">
<h2 class="hasAnchor">
<a href="#ordinary-kriging-example" class="anchor"></a>Ordinary kriging example</h2>
<p>Here is the code using pure <strong>gstat</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># computing sample variogram</span>
lzn.vgm =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/variogram">variogram</a></span>(<span class="kw">log</span>(zinc)<span class="op">~</span><span class="dv">1</span>, meuse)
<span class="co"># manually fitting a model to the vgm with constant mean</span>
lzn.fit =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/fit.variogram">fit.variogram</a></span>(lzn.vgm, <span class="dt">model =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/vgm">vgm</a></span>(<span class="dv">1</span>, <span class="st">"Sph"</span>, <span class="dv">900</span>, <span class="dv">1</span>))
<span class="co"># to show the plot run : plot(lzn.vgm, lzn.fit)</span>
<span class="co"># kriging</span>
ok.gstat =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw">log</span>(zinc)<span class="op">~</span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">model =</span> lzn.fit)
## [using ordinary kriging]
<span class="co"># mapping</span>
ok.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.gstat[<span class="st">"var1.pred"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ok interpolation (gstat)"</span>)
<span class="co"># mapping the se</span>
ok.se.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.gstat[<span class="st">"var1.var"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ok interpolation (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># adding a column with log zinc</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">log_zinc =</span> <span class="kw">log</span>(zinc))
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="../reference/Task.html">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"log_zinc"</span>)
task.krg =<span class="st"> </span><span class="kw"><a href="../reference/dropFeatures.html">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="../reference/getTaskFeatureNames.html">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])
<span class="co"># defining the learner</span>
lrn.krg =<span class="st"> </span><span class="kw"><a href="../reference/makeLearner.html">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"ln(zn) mlr ordinary kriging"</span>, <span class="dt">predict.type =</span> <span class="st">"response"</span>, <span class="dt">psill =</span> <span class="dv">1</span>, <span class="dt">model =</span> <span class="st">"Sph"</span>, <span class="dt">range =</span> <span class="dv">900</span>, <span class="dt">nugget =</span> <span class="dv">1</span>, <span class="dt">locations =</span> <span class="op">~</span>x<span class="op">+</span>y)
<span class="co"># training the model</span>
mod.krg =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(lrn.krg, task.krg)
<span class="co"># kriging</span>
newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> mod.krg, <span class="dt">newdata =</span> meuse.grid)
ok.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), newdata.pred.krg<span class="op">$</span>data)
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ok.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ok.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ok.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.mlr[<span class="st">"response"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ok interpolation (gstat)"</span>)
<span class="co"># SE - defining the standard error learner by altering the previous one.</span>
se.lrn.krg =<span class="st"> </span><span class="kw"><a href="../reference/setPredictType.html">setPredictType</a></span>(lrn.krg, <span class="dt">predict.type =</span> <span class="st">"se"</span>)
<span class="co"># training the SE model</span>
se.mod.krg =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(se.lrn.krg, task.krg)
<span class="co"># SE kriging</span>
se.newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> se.mod.krg, <span class="dt">newdata =</span> meuse.grid)
ok.se.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), se.newdata.pred.krg<span class="op">$</span>data)
<span class="co"># SE mapping</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ok.se.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ok.se.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ok.se.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.se.mlr[<span class="st">"se"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ok interpolation (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="usecase_gstat_files/figure-html/ok_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(ok.gstat[<span class="st">"var1.pred"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]], ok.mlr[<span class="st">"response"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]])
## [1] TRUE</code></pre></div>
</div>
<div id="kriging-with-external-drift-ked-universal-kriging-uk" class="section level2">
<h2 class="hasAnchor">
<a href="#kriging-with-external-drift-ked-universal-kriging-uk" class="anchor"></a>Kriging with External Drift (KED) = Universal Kriging (UK)</h2>
<p>Using <strong>gstat</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># computing sample variogram</span>
lzn.vgm =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/variogram">variogram</a></span>(<span class="kw">log</span>(zinc)<span class="op">~</span><span class="dv">1</span>, meuse)
<span class="co"># manually fitting a model to the vgm with a mean function where sqrt dist is the explanatory var</span>
lzn.vgm =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/variogram">variogram</a></span>(<span class="kw">log</span>(zinc)<span class="op">~</span><span class="kw">sqrt</span>(dist), meuse)
lzn.fit =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/fit.variogram">fit.variogram</a></span>(lzn.vgm, <span class="dt">model =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/vgm">vgm</a></span>(<span class="dv">1</span>, <span class="st">"Exp"</span>, <span class="dv">300</span>, <span class="dv">1</span>))
<span class="co"># to show the plot run : plot(lzn.vgm, lzn.fit)</span>
<span class="co"># kriging</span>
ked.gstat =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw">log</span>(zinc)<span class="op">~</span><span class="kw">sqrt</span>(dist), meuse, meuse.grid, <span class="dt">model =</span> lzn.fit)
## [using universal kriging]
<span class="co"># mapping</span>
ked.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.gstat[<span class="st">"var1.pred"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ked interpolation (gstat)"</span>)
<span class="co"># mapping the se</span>
ked.se.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.gstat[<span class="st">"var1.var"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ked interpolation (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw">data</span>(meuse)
<span class="kw">data</span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="../reference/impute.html">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw">list</span>(<span class="dt">numeric =</span> <span class="kw"><a href="../reference/imputations.html">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="../reference/imputations.html">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># adding a column with log zinc</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">log_zinc =</span> <span class="kw">log</span>(zinc))
<span class="co"># adding a column with sqrt dist</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">sqrt_dist =</span> <span class="kw">sqrt</span>(dist))
meuse.grid =<span class="st"> </span>meuse.grid <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">sqrt_dist =</span> <span class="kw">sqrt</span>(dist))
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="../reference/Task.html">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"log_zinc"</span>)
task.krg =<span class="st"> </span><span class="kw"><a href="../reference/dropFeatures.html">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="../reference/getTaskFeatureNames.html">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">15</span>)])
<span class="co"># defining the learner</span>
lrn.krg =<span class="st"> </span><span class="kw"><a href="../reference/makeLearner.html">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"ln(zn) mlr kriging with external drift"</span>, <span class="dt">predict.type =</span> <span class="st">"response"</span>,  <span class="dt">psill =</span> <span class="dv">1</span>, <span class="dt">model =</span> <span class="st">"Exp"</span>, <span class="dt">range =</span> <span class="dv">300</span>, <span class="dt">nugget =</span> <span class="dv">1</span>, <span class="dt">locations =</span> <span class="op">~</span>x<span class="op">+</span>y) 
<span class="co"># training the model</span>
mod.krg =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(lrn.krg, task.krg)
<span class="co"># kriging</span>
newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> mod.krg, <span class="dt">newdata =</span> meuse.grid)
ked.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), newdata.pred.krg<span class="op">$</span>data)
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ked.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ked.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ked.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.mlr[<span class="st">"response"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ked interpolation (mlr)"</span>)
<span class="co"># SE - defining the standard error learner by altering the previous one.</span>
se.lrn.krg =<span class="st"> </span><span class="kw"><a href="../reference/setPredictType.html">setPredictType</a></span>(lrn.krg, <span class="dt">predict.type =</span> <span class="st">"se"</span>)
<span class="co"># training the SE model</span>
se.mod.krg =<span class="st"> </span><span class="kw"><a href="../reference/train.html">train</a></span>(se.lrn.krg, task.krg)
<span class="co"># SE kriging</span>
se.newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> se.mod.krg, <span class="dt">newdata =</span> meuse.grid)
ked.se.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">data.frame</span>(meuse.grid), se.newdata.pred.krg<span class="op">$</span>data)
<span class="co"># SE mapping</span>
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ked.se.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ked.se.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ked.se.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.se.mlr[<span class="st">"se"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ked interpolation (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="usecase_gstat_files/figure-html/ked_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(ked.gstat[<span class="st">"var1.pred"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]], ked.mlr[<span class="st">"response"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]])
## [1] TRUE</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#inverse-distance-weighted">Inverse distance Weighted</a></li>
      <li><a href="#trend-surfaces-interpolation-">Trend surfaces interpolation.</a></li>
      <li><a href="#ordinary-kriging-example">Ordinary kriging example</a></li>
      <li><a href="#kriging-with-external-drift-ked-universal-kriging-uk">Kriging with External Drift (KED) = Universal Kriging (UK)</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><!--<div class="copyright">
  <p>Developed by Bernd Bischl, Michel Lang, Lars Kotthoff, Julia Schiffner, Jakob Richter, Zachary Jones, Giuseppe Casalicchio, Mason Gallo, Patrick Schratz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>
--></footer>
</div>

   
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script type="text/javascript"> docsearch({
 apiKey: 'e300ecafdf04fe1199e3339c825ce7d0',
 indexName: 'mlr',
 inputSelector: 'input#search-input.form-control',
 debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>
</html>

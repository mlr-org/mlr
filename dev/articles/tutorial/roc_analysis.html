<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROC Analysis and Performance Curves • mlr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<link href="../../extra.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="ROC Analysis and Performance Curves">
<meta property="og:description" content="mlr">
<meta property="og:image" content="https://mlr.mlr-org.com/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://mlr-org.com"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png" id="hexlogo" alt="mlr-org"></a>
        <a class="navbar-brand" href="../../index.html">mlr <small>v2.17.1.9004</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/task.html">Task</a>
    </li>
    <li>
      <a href="../../articles/tutorial/learner.html">Learner</a>
    </li>
    <li>
      <a href="../../articles/tutorial/train.html">Train</a>
    </li>
    <li>
      <a href="../../articles/tutorial/predict.html">Predict</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/tutorial/preproc.html">Preprocessing</a>
    </li>
    <li>
      <a href="../../articles/tutorial/tune.html">Tuning</a>
    </li>
    <li>
      <a href="../../articles/tutorial/resample.html">Resampling</a>
    </li>
    <li>
      <a href="../../articles/tutorial/benchmark_experiments.html">Benchmarking</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/tutorial/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../../articles/tutorial/performance.html">Performance</a>
    </li>
    <li>
      <a href="../../articles/tutorial/visualization.html">Visualization</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/tutorial/usecase_regression.html">Use case - Regression</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/configureMlr.html">mlr Configuration</a>
    </li>
    <li>
      <a href="../../articles/tutorial/wrapper.html">Wrapped Learners</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/tutorial/impute.html">Imputation</a>
    </li>
    <li>
      <a href="../../articles/tutorial/bagging.html">Generic Bagging</a>
    </li>
    <li>
      <a href="../../articles/tutorial/advanced_tune.html">Advanced Tuning</a>
    </li>
    <li>
      <a href="../../articles/tutorial/feature_selection.html">Feature Selection/Filtering</a>
    </li>
    <li>
      <a href="../../articles/tutorial/nested_resampling.html">Nested Resampling</a>
    </li>
    <li>
      <a href="../../articles/tutorial/over_and_undersampling.html">Imbalanced Classification Problems</a>
    </li>
    <li>
      <a href="../../articles/tutorial/roc_analysis.html">ROC Analysis and Performance Curves</a>
    </li>
    <li>
      <a href="../../articles/tutorial/learning_curve.html">Learning Curve Analysis</a>
    </li>
    <li>
      <a href="../../articles/tutorial/partial_dependence.html">Partial Dependence Plots</a>
    </li>
    <li>
      <a href="../../articles/tutorial/classifier_calibration.html">Classifier Calibration</a>
    </li>
    <li>
      <a href="../../articles/tutorial/hyperpar_tuning_effects.html">Hyperparameter Tuning Effects</a>
    </li>
    <li>
      <a href="../../articles/tutorial/out_of_bag_predictions.html">Out-of-Bag Predictions</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/tutorial/multilabel.html">Multilabel Classification</a>
    </li>
    <li>
      <a href="../../articles/tutorial/cost_sensitive_classif.html">Cost-Sensitive Classification</a>
    </li>
    <li>
      <a href="../../articles/tutorial/handling_of_spatial_data.html">Spatial Data</a>
    </li>
    <li>
      <a href="../../articles/tutorial/functional_data.html">Functional Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extending
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/create_learner.html">Create Custom Learners</a>
    </li>
    <li>
      <a href="../../articles/tutorial/create_measure.html">Create Custom Measures</a>
    </li>
    <li>
      <a href="../../articles/tutorial/create_imputation.html">Create Custom Imputation Methods</a>
    </li>
    <li>
      <a href="../../articles/tutorial/create_filter.html">Create Custom Filters</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/example_tasks.html">Integrated Tasks</a>
    </li>
    <li>
      <a href="../../articles/tutorial/integrated_learners.html">Integrated Learners</a>
    </li>
    <li>
      <a href="../../articles/tutorial/measures.html">Integrated Measures</a>
    </li>
    <li>
      <a href="../../articles/tutorial/filter_methods.html">Integrated Filter Methods</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/tutorial/mlr_publications.html">mlr Publications</a>
    </li>
    <li>
      <a href="https://github.com/mlr-org/mlr-outreach">Talks, Videos and Workshops</a>
    </li>
    <li class="divider">
    <li>
      <a href="https://mlrmbo.mlr-org.com">mlrMBO</a>
    </li>
    <li>
      <a href="https://https://mlrcpo.mlr-org.com">mlrCPO</a>
    </li>
    <li>
      <a href="https://jakob-r.de/mlrHyperopt/index.html">mlrHyperopt</a>
    </li>
    <li>
      <a href="http://openml.github.io/openml-r/">OpenML</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
        <li>
  <a href="https://github.com/mlr-org/mlr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa fa fa-comments"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right docsearch" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="roc_analysis_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ROC Analysis and Performance Curves</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr/blob/master/vignettes/tutorial/roc_analysis.Rmd"><code>vignettes/tutorial/roc_analysis.Rmd</code></a></small>
      <div class="hidden name"><code>roc_analysis.Rmd</code></div>

    </div>

    
    
<p>For binary scoring classifiers a <em>threshold</em> (or <em>cutoff</em>) value controls how predicted posterior probabilities are converted into class labels. ROC curves and other performance plots serve to visualize and analyse the relationship between one or two performance measures and the threshold.</p>
<p>This page is mainly devoted to <em>receiver operating characteristic</em> (ROC) curves that plot the <em>true positive rate</em> (sensitivity) on the vertical axis against the <em>false positive rate</em> (1 - specificity, fall-out) on the horizontal axis for all possible threshold values. Creating other performance plots like <em>lift charts</em> or <em>precision/recall graphs</em> works analogously and is shown briefly.</p>
<p>In addition to performance visualization ROC curves are helpful in</p>
<ul>
<li>determining an optimal decision threshold for given class prior probabilities and misclassification costs (for alternatives see also the pages about <a href="cost_sensitive_classif.html" target="_blank">cost-sensitive classification</a> and <a href="over_and_undersampling.html" target="_blank">imbalanced classification problems</a> in this tutorial),</li>
<li>identifying regions where one classifier outperforms another and building suitable multi-classifier systems,</li>
<li>obtaining calibrated estimates of the posterior probabilities.</li>
</ul>
<p>For more information see the tutorials and introductory papers by <a href="http://binf.gmu.edu/mmasso/ROC101.pdf">Fawcett (2004)</a>, <a href="https://ccrma.stanford.edu/workshops/mir2009/references/ROCintro.pdf">Fawcett (2006)</a> as well as <a href="http://www.cs.bris.ac.uk/~flach/ICML04tutorial/index.html" target="_blank">Flach (ICML 2004)</a>.</p>
<p>In many applications as, e.g., diagnostic tests or spam detection, there is uncertainty about the class priors or the misclassification costs at the time of prediction, for example because it’s hard to quantify the costs or because costs and class priors vary over time. Under these circumstances the classifier is expected to work well for a whole range of decision thresholds and the area under the ROC curve (AUC) provides a scalar performance measure for comparing and selecting classifiers. <code>mlr</code> provides the AUC for binary classification (<a href="measures.html" target="_blank">auc</a>) and also several generalizations of the AUC to the multi-class case (e.g., <a href="measures.html" target="_blank">multiclass.au1p</a>, <a href="measures.html" target="_blank">multiclass.au1u</a> based on <a href="https://www.math.ucdavis.edu/~saito/data/roc/ferri-class-perf-metrics.pdf">Ferri et al. (2009)</a>).</p>
<p><code>mlr</code> offers three ways to plot ROC and other performance curves.</p>
<ol style="list-style-type: decimal">
<li>Function <code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code> can, based on the output of <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code>, plot performance curves for any pair of <a href="measures.html" target="_blank">performance measures</a> available in <code>mlr</code>.</li>
<li>
<code>mlr</code> offers an interface to package <code>ROCR</code> through function <code><a href="../../reference/asROCRPrediction.html">asROCRPrediction()</a></code>.</li>
<li>
<code>mlr</code>’s function <code>plotViperCharts()</code> provides an interface to <a href="http://viper.ijs.si">ViperCharts</a>.</li>
</ol>
<p>With <code>mlr</code> version 2.8 functions <code>generateROCRCurvesData</code>, <code>plotROCRCurves</code>, and <code>plotROCRCurvesGGVIS</code> were deprecated.</p>
<p>Below are some examples that demonstrate the three possible ways. Note that you can only use <a href="learner.html" target="_blank">learners</a> that are capable of predicting probabilities. Have a look at the learner table in the <a href="integrated_learners.html" target="_blank">Appendix</a> or run <code><a href="../../reference/listLearners.html">listLearners("classif", properties = c("twoclass", "prob"))</a></code> to get a list of all learners that support this.</p>
<div id="performance-plots-with-plotroccurves" class="section level1">
<h1 class="hasAnchor">
<a href="#performance-plots-with-plotroccurves" class="anchor"></a>Performance plots with plotROCCurves</h1>
<p>As you might recall <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> calculates one or several performance measures for a sequence of decision thresholds from 0 to 1. It provides S3 methods for objects of class <code><a href="../../reference/Prediction.html">Prediction()</a></code>, <code><a href="../../reference/ResampleResult.html">ResampleResult()</a></code> and <code><a href="../../reference/BenchmarkResult.html">BenchmarkResult()</a></code> (resulting from <code>predict</code> (<code><a href="../../reference/predict.WrappedModel.html">predict.WrappedModel()</a></code>), <code><a href="../../reference/resample.html">resample()</a></code> or <code><a href="../../reference/benchmark.html">benchmark()</a></code>). <code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code> plots the result of <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> using <code>ggplot2</code>.</p>
<div id="example-1-single-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-single-predictions" class="anchor"></a>Example 1: Single predictions</h2>
<p>We consider the <code>Sonar</code> (<code><a href="https://rdrr.io/pkg/mlbench/man/Sonar.html">mlbench::Sonar()</a></code>) data set from package <code>mlbench</code>, which poses a binary classification problem (<code><a href="../../reference/sonar.task.html">sonar.task()</a></code>) and apply linear discriminant analysis (<code><a href="https://rdrr.io/pkg/MASS/man/lda.html">MASS::lda()</a></code>).</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">n</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getTaskSize.html">getTaskSize</a></span>(<span class="no">sonar.task</span>)
<span class="no">train.set</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">n</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">2</span>/<span class="fl">3</span> * <span class="no">n</span>))
<span class="no">test.set</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="no">n</span>), <span class="no">train.set</span>)

<span class="no">lrn1</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/makeLearner.html">makeLearner</a></span>(<span class="st">"classif.lda"</span>, <span class="kw">predict.type</span> <span class="kw">=</span> <span class="st">"prob"</span>)
<span class="no">mod1</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/train.html">train</a></span>(<span class="no">lrn1</span>, <span class="no">sonar.task</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="no">train.set</span>)
<span class="no">pred1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mod1</span>, <span class="kw">task</span> <span class="kw">=</span> <span class="no">sonar.task</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="no">test.set</span>)</pre></body></html></div>
<p>Since we want to plot ROC curves we calculate the false and true positive rates (<a href="measures.html" target="_blank">fpr</a> and <a href="measures.html" target="_blank">tpr</a>). Additionally, we also compute error rates (<a href="measures.html" target="_blank">mmce</a>).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData</a></span>(<span class="no">pred1</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">fpr</span>, <span class="no">tpr</span>, <span class="no">mmce</span>))</pre></body></html></div>
<p><code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> returns an object of class <code>ThreshVsPerfData</code> (<code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code>) which contains the performance values in the <code>$data</code> element.</p>
<p>Per default, <code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code> plots the performance values of the first two measures passed to <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code>. The first is shown on the x-axis, the second on the y-axis. Moreover, a diagonal line that represents the performance of a random classifier is added. You can remove the diagonal by setting <code>diagonal = FALSE</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../../reference/plotROCCurves.html">plotROCCurves</a></span>(<span class="no">df</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-4-1.png" width="75%"></p>
<p>The corresponding area under curve (<a href="measures.html" target="_blank">auc</a>) can be calculated as usual by calling <code><a href="../../reference/performance.html">performance()</a></code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="fu"><a href="../../reference/performance.html">performance</a></span>(<span class="no">pred1</span>, <span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="no"><a href="../../reference/measures.html">auc</a></span>)
<span class="co">##       auc </span>
<span class="co">## 0.7871622</span></pre></body></html></div>
<p><code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code> always requires a pair of performance measures that are plotted against each other. If you want to plot individual measures versus the decision threshold you can use function <code><a href="../../reference/plotThreshVsPerf.html">plotThreshVsPerf()</a></code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../../reference/plotThreshVsPerf.html">plotThreshVsPerf</a></span>(<span class="no">df</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Additional to linear discriminant analysis (<code><a href="https://rdrr.io/pkg/MASS/man/lda.html">MASS::lda()</a></code>) we try a support vector machine with RBF kernel (<code><a href="https://rdrr.io/pkg/kernlab/man/ksvm.html">kernlab::ksvm()</a></code>).</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">lrn2</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/makeLearner.html">makeLearner</a></span>(<span class="st">"classif.ksvm"</span>, <span class="kw">predict.type</span> <span class="kw">=</span> <span class="st">"prob"</span>)
<span class="no">mod2</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/train.html">train</a></span>(<span class="no">lrn2</span>, <span class="no">sonar.task</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="no">train.set</span>)
<span class="no">pred2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mod2</span>, <span class="kw">task</span> <span class="kw">=</span> <span class="no">sonar.task</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="no">test.set</span>)</pre></body></html></div>
<p>In order to compare the performance of the two learners you might want to display the two corresponding ROC curves in one plot. For this purpose just pass a named <code>list</code> of <code><a href="../../reference/Prediction.html">Prediction()</a></code>s to <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lda</span> <span class="kw">=</span> <span class="no">pred1</span>, <span class="kw">ksvm</span> <span class="kw">=</span> <span class="no">pred2</span>), <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">fpr</span>, <span class="no">tpr</span>))
<span class="fu"><a href="../../reference/plotROCCurves.html">plotROCCurves</a></span>(<span class="no">df</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>It’s clear from the plot above that <code><a href="https://rdrr.io/pkg/kernlab/man/ksvm.html">kernlab::ksvm()</a></code> has a slightly higher AUC than lda (<code><a href="https://rdrr.io/pkg/MASS/man/lda.html">MASS::lda()</a></code>).</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="fu"><a href="../../reference/performance.html">performance</a></span>(<span class="no">pred2</span>, <span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="no"><a href="../../reference/measures.html">auc</a></span>)
<span class="co">##       auc </span>
<span class="co">## 0.8834459</span></pre></body></html></div>
<p>Based on the <code>$data</code> member of <code>df</code> you can easily generate custom plots. Below the curves for the two learners are superposed.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">qplot</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">fpr</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">tpr</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">learner</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">df</span>$<span class="no">data</span>, <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"path"</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-10-1.png" width="75%"></p>
<p>It is easily possible to generate other performance plots by passing the appropriate performance measures to <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> and <code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code>. Below, we generate a <em>precision/recall graph</em> (precision = positive predictive value = ppv, recall = tpr) and a <em>sensitivity/specificity plot</em> (sensitivity = tpr, specificity = tnr).</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lda</span> <span class="kw">=</span> <span class="no">pred1</span>, <span class="kw">ksvm</span> <span class="kw">=</span> <span class="no">pred2</span>), <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">ppv</span>, <span class="no">tpr</span>, <span class="no">tnr</span>))

<span class="co"># Precision/recall graph</span>
<span class="fu"><a href="../../reference/plotROCCurves.html">plotROCCurves</a></span>(<span class="no">df</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tpr</span>, <span class="no">ppv</span>), <span class="kw">diagonal</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Sensitivity/specificity plot</span>
<span class="fu"><a href="../../reference/plotROCCurves.html">plotROCCurves</a></span>(<span class="no">df</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">tnr</span>, <span class="no">tpr</span>), <span class="kw">diagonal</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-11-1.png" width="50%"><img src="roc_analysis_files/figure-html/unnamed-chunk-11-2.png" width="50%"></p>
</div>
<div id="example-2-benchmark-experiment" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-benchmark-experiment" class="anchor"></a>Example 2: Benchmark experiment</h2>
<p>The analysis in the example above can be improved a little. Instead of writing individual code for training/prediction of each learner, which can become tedious very quickly, we can use function <code><a href="../../reference/benchmark.html">benchmark()</a></code> (see also <a href="benchmark_experiments.html" target="_blank">Benchmark Experiments</a>) and, ideally, the support vector machine should have been <a href="tune.html" target="_blank">tuned</a>.</p>
<p>We again consider the <code>Sonar</code> (<code><a href="https://rdrr.io/pkg/mlbench/man/Sonar.html">mlbench::Sonar()</a></code>) data set and apply <code><a href="https://rdrr.io/pkg/MASS/man/lda.html">MASS::lda()</a></code> as well as <code><a href="https://rdrr.io/pkg/kernlab/man/ksvm.html">kernlab::ksvm()</a></code>. We first generate a tuning wrapper (<code><a href="../../reference/makeTuneWrapper.html">makeTuneWrapper()</a></code>) for <code><a href="https://rdrr.io/pkg/kernlab/man/ksvm.html">kernlab::ksvm()</a></code>. The cost parameter is tuned on a (for demonstration purposes small) parameter grid. We assume that we are interested in a good performance over the complete threshold range and therefore tune with regard to the <a href="measures.html" target="_blank">auc</a>. The error rate (<a href="measures.html" target="_blank">mmce</a>) for a threshold value of 0.5 is reported as well.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># Tune wrapper for ksvm</span>
<span class="no">rdesc.inner</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/makeResampleDesc.html">makeResampleDesc</a></span>(<span class="st">"Holdout"</span>)
<span class="no">ms</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="no"><a href="../../reference/measures.html">auc</a></span>, <span class="no">mmce</span>)
<span class="no">ps</span> <span class="kw">=</span> <span class="fu">makeParamSet</span>(
  <span class="fu">makeDiscreteParam</span>(<span class="st">"C"</span>, <span class="fl">2</span>^(-<span class="fl">1</span>:<span class="fl">1</span>))
)
<span class="no">ctrl</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/makeTuneControlGrid.html">makeTuneControlGrid</a></span>()
<span class="no">lrn2</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/makeTuneWrapper.html">makeTuneWrapper</a></span>(<span class="no">lrn2</span>, <span class="no">rdesc.inner</span>, <span class="no">ms</span>, <span class="no">ps</span>, <span class="no">ctrl</span>, <span class="kw">show.info</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Below the actual benchmark experiment is conducted. As resampling strategy we use 5-fold cross-validation and again calculate the <a href="measures.html" target="_blank">auc</a> as well as the error rate (for a threshold/cutoff value of 0.5).</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Benchmark experiment</span>
<span class="no">lrns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">lrn1</span>, <span class="no">lrn2</span>)
<span class="no">rdesc.outer</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/makeResampleDesc.html">makeResampleDesc</a></span>(<span class="st">"CV"</span>, <span class="kw">iters</span> <span class="kw">=</span> <span class="fl">5</span>)

<span class="no">bmr</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/benchmark.html">benchmark</a></span>(<span class="no">lrns</span>, <span class="kw">tasks</span> <span class="kw">=</span> <span class="no">sonar.task</span>, <span class="kw">resampling</span> <span class="kw">=</span> <span class="no">rdesc.outer</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="no">ms</span>, <span class="kw">show.info</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">bmr</span>
<span class="co">##         task.id         learner.id auc.test.mean mmce.test.mean</span>
<span class="co">## 1 Sonar-example        classif.lda     0.7950028      0.2547038</span>
<span class="co">## 2 Sonar-example classif.ksvm.tuned     0.9243248      0.1632985</span></pre></body></html></div>
<p>Calling <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> and <code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code> on the benchmark result (<code><a href="../../reference/BenchmarkResult.html">BenchmarkResult()</a></code>) produces a plot with ROC curves for all learners in the experiment.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData</a></span>(<span class="no">bmr</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">fpr</span>, <span class="no">tpr</span>, <span class="no">mmce</span>))
<span class="fu"><a href="../../reference/plotROCCurves.html">plotROCCurves</a></span>(<span class="no">df</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Per default, <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> calculates aggregated performances according to the chosen resampling strategy (5-fold cross-validation) and aggregation scheme (<code>test.mean</code> (<code><a href="../../reference/aggregations.html">aggregations()</a></code>)) for each threshold in the sequence. This way we get <em>threshold-averaged</em> ROC curves.</p>
<p>If you want to plot the individual ROC curves for each resample iteration set <code>aggregate = FALSE</code>.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData</a></span>(<span class="no">bmr</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">fpr</span>, <span class="no">tpr</span>, <span class="no">mmce</span>), <span class="kw">aggregate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="fu"><a href="../../reference/plotROCCurves.html">plotROCCurves</a></span>(<span class="no">df</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The same applies for <code><a href="../../reference/plotThreshVsPerf.html">plotThreshVsPerf()</a></code>.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../../reference/plotThreshVsPerf.html">plotThreshVsPerf</a></span>(<span class="no">df</span>) +
  <span class="fu">theme</span>(<span class="kw">strip.text.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">7</span>))</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>An alternative to averaging is to just merge the 5 test folds and draw a single ROC curve. Merging can be achieved by manually changing the class attribute of the prediction objects from <code><a href="../../reference/ResamplePrediction.html">ResamplePrediction()</a></code> to <code><a href="../../reference/Prediction.html">Prediction()</a></code>.</p>
<p>Below, the predictions are extracted from the <code><a href="../../reference/BenchmarkResult.html">BenchmarkResult()</a></code> via function <code><a href="../../reference/getBMRPredictions.html">getBMRPredictions()</a></code>, the class is changed and the ROC curves are created.</p>
<p>Averaging methods are normally preferred (cp. <a href="https://ccrma.stanford.edu/workshops/mir2009/references/ROCintro.pdf">Fawcett, 2006</a>), as they permit to assess the variability, which is needed to properly compare classifier performance.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># Extract predictions</span>
<span class="no">preds</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getBMRPredictions.html">getBMRPredictions</a></span>(<span class="no">bmr</span>, <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Change the class attribute</span>
<span class="no">preds2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">preds</span>, <span class="kw">function</span>(<span class="no">x</span>) {<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">x</span>) <span class="kw">=</span> <span class="st">"Prediction"</span>; <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">x</span>)})

<span class="co"># Draw ROC curves</span>
<span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData</a></span>(<span class="no">preds2</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">fpr</span>, <span class="no">tpr</span>, <span class="no">mmce</span>))
<span class="fu"><a href="../../reference/plotROCCurves.html">plotROCCurves</a></span>(<span class="no">df</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Again, you can easily create other standard evaluation plots by passing the appropriate performance measures to <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> and <code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code>.</p>
</div>
</div>
<div id="performance-plots-with-asrocrprediction" class="section level1">
<h1 class="hasAnchor">
<a href="#performance-plots-with-asrocrprediction" class="anchor"></a>Performance plots with asROCRPrediction</h1>
<p>Drawing performance plots with package <code>ROCR</code> works through three basic commands:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/ROCR/man/prediction.html">ROCR::prediction()</a></code>: Create a <code>ROCR</code> prediction object.</li>
<li>
<code><a href="https://rdrr.io/pkg/ROCR/man/performance.html">ROCR::performance()</a></code>: Calculate one or more performance measures for the given prediction object.</li>
<li>
<code>ROCR::plot()</code>: Generate the performance plot.</li>
</ol>
<p><code>mlr</code>’s function <code><a href="../../reference/asROCRPrediction.html">asROCRPrediction()</a></code> converts an <code>mlr</code> <code><a href="../../reference/Prediction.html">Prediction()</a></code> object to a <code>ROCR</code> prediction (<code>ROCR::prediction-class()</code>) object, so you can easily generate performance plots by doing steps 2. and 3. yourself. <code>ROCR</code>’s plot (<code>ROCR::plot-methods()</code>) method has some nice features which are not (yet) available in <code><a href="../../reference/plotROCCurves.html">plotROCCurves()</a></code>, for example plotting the convex hull of the ROC curves. Some examples are shown below.</p>
<div id="example-1-single-predictions-continued" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-single-predictions-continued" class="anchor"></a>Example 1: Single predictions (continued)</h2>
<p>We go back to out first example where we trained and predicted <code><a href="https://rdrr.io/pkg/MASS/man/lda.html">MASS::lda()</a></code> on the sonar classification task (<code><a href="../../reference/sonar.task.html">sonar.task()</a></code>).</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">n</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getTaskSize.html">getTaskSize</a></span>(<span class="no">sonar.task</span>)
<span class="no">train.set</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">n</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">2</span>/<span class="fl">3</span> * <span class="no">n</span>))
<span class="no">test.set</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="no">n</span>), <span class="no">train.set</span>)

<span class="co"># Train and predict linear discriminant analysis</span>
<span class="no">lrn1</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/makeLearner.html">makeLearner</a></span>(<span class="st">"classif.lda"</span>, <span class="kw">predict.type</span> <span class="kw">=</span> <span class="st">"prob"</span>)
<span class="no">mod1</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/train.html">train</a></span>(<span class="no">lrn1</span>, <span class="no">sonar.task</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="no">train.set</span>)
<span class="no">pred1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mod1</span>, <span class="kw">task</span> <span class="kw">=</span> <span class="no">sonar.task</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="no">test.set</span>)</pre></body></html></div>
<p>Below we use <code><a href="../../reference/asROCRPrediction.html">asROCRPrediction()</a></code> to convert the lda prediction, let <code>ROCR</code> calculate the true and false positive rate and plot the ROC curve.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co"># Convert prediction</span>
<span class="no">ROCRpred1</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/asROCRPrediction.html">asROCRPrediction</a></span>(<span class="no">pred1</span>)

<span class="co"># Calculate true and false positive rate</span>
<span class="no">ROCRperf1</span> <span class="kw">=</span> <span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ROCR/man/performance.html">performance</a></span>(<span class="no">ROCRpred1</span>, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)

<span class="co"># Draw ROC curve</span>
<span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu">plot</span>(<span class="no">ROCRperf1</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-19-1.png" width="75%"></p>
<p>Below is the same ROC curve, but we make use of some more graphical parameters: The ROC curve is color-coded by the threshold and selected threshold values are printed on the curve. Additionally, the convex hull (black broken line) of the ROC curve is drawn.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># Draw ROC curve</span>
<span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu">plot</span>(<span class="no">ROCRperf1</span>, <span class="kw">colorize</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">print.cutoffs.at</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>), <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># Draw convex hull of ROC curve</span>
<span class="no">ch</span> <span class="kw">=</span> <span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ROCR/man/performance.html">performance</a></span>(<span class="no">ROCRpred1</span>, <span class="st">"rch"</span>)
<span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu">plot</span>(<span class="no">ch</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-20-1.png" width="75%"></p>
</div>
<div id="example-2-benchmark-experiments-continued" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-benchmark-experiments-continued" class="anchor"></a>Example 2: Benchmark experiments (continued)</h2>
<p>We again consider the benchmark experiment conducted earlier. We first extract the predictions by <code><a href="../../reference/getBMRPredictions.html">getBMRPredictions()</a></code> and then convert them via function <code><a href="../../reference/asROCRPrediction.html">asROCRPrediction()</a></code>.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># Extract predictions</span>
<span class="no">preds</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getBMRPredictions.html">getBMRPredictions</a></span>(<span class="no">bmr</span>, <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Convert predictions</span>
<span class="no">ROCRpreds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">preds</span>, <span class="no">asROCRPrediction</span>)

<span class="co"># Calculate true and false positive rate</span>
<span class="no">ROCRperfs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">ROCRpreds</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ROCR/man/performance.html">performance</a></span>(<span class="no">x</span>, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>))</pre></body></html></div>
<p>We draw the vertically averaged ROC curves (solid lines) as well as the ROC curves for the individual resampling iterations (broken lines). Moreover, standard error bars are plotted for selected true positive rates (0.1, 0.2, …, 0.9). See <code>ROCR</code>’s plot (<code>ROCR::plot-methods()</code>) function for details.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="co"># lda average ROC curve</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ROCRperfs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">avg</span> <span class="kw">=</span> <span class="st">"vertical"</span>, <span class="kw">spread.estimate</span> <span class="kw">=</span> <span class="st">"stderror"</span>,
  <span class="kw">show.spread.at</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>), <span class="kw">plotCI.col</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">plotCI.lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co"># lda individual ROC curves</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ROCRperfs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># ksvm average ROC curve</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ROCRperfs</span><span class="kw">[[</span><span class="fl">2</span>]], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">avg</span> <span class="kw">=</span> <span class="st">"vertical"</span>, <span class="kw">spread.estimate</span> <span class="kw">=</span> <span class="st">"stderror"</span>,
  <span class="kw">show.spread.at</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.1</span>), <span class="kw">plotCI.col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">plotCI.lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co"># ksvm individual ROC curves</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ROCRperfs</span><span class="kw">[[</span><span class="fl">2</span>]], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomright"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getBMRLearnerIds.html">getBMRLearnerIds</a></span>(<span class="no">bmr</span>), <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-22-1.png" width="75%"></p>
<p>In order to create other evaluation plots like <em>precision/recall graphs</em> you just have to change the performance measures when calling <code><a href="https://rdrr.io/pkg/ROCR/man/performance.html">ROCR::performance()</a></code>. (Note that you have to use the measures provided by <code>ROCR</code> listed in <code><a href="https://rdrr.io/pkg/ROCR/man/performance.html">ROCR::performance()</a></code> and not <code>mlr</code>’s performance measures.)</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co"># Extract and convert predictions</span>
<span class="no">preds</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getBMRPredictions.html">getBMRPredictions</a></span>(<span class="no">bmr</span>, <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">ROCRpreds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">preds</span>, <span class="no">asROCRPrediction</span>)

<span class="co"># Calculate precision and recall</span>
<span class="no">ROCRperfs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">ROCRpreds</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ROCR/man/performance.html">performance</a></span>(<span class="no">x</span>, <span class="st">"prec"</span>, <span class="st">"rec"</span>))

<span class="co"># Draw performance plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ROCRperfs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">avg</span> <span class="kw">=</span> <span class="st">"threshold"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ROCRperfs</span><span class="kw">[[</span><span class="fl">2</span>]], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">avg</span> <span class="kw">=</span> <span class="st">"threshold"</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomleft"</span>, <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getBMRLearnerIds.html">getBMRLearnerIds</a></span>(<span class="no">bmr</span>), <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-23-1.png" width="75%"></p>
<p>If you want to plot a performance measure versus the threshold, specify only one measure when calling <code><a href="https://rdrr.io/pkg/ROCR/man/performance.html">ROCR::performance()</a></code>. Below the average accuracy over the 5 cross-validation iterations is plotted against the threshold. Moreover, boxplots for certain threshold values (0.1, 0.2, …, 0.9) are drawn.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co"># Extract and convert predictions</span>
<span class="no">preds</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getBMRPredictions.html">getBMRPredictions</a></span>(<span class="no">bmr</span>, <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">ROCRpreds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">preds</span>, <span class="no">asROCRPrediction</span>)

<span class="co"># Calculate accuracy</span>
<span class="no">ROCRperfs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">ROCRpreds</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">ROCR</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ROCR/man/performance.html">performance</a></span>(<span class="no">x</span>, <span class="st">"acc"</span>))

<span class="co"># Plot accuracy versus threshold</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ROCRperfs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">avg</span> <span class="kw">=</span> <span class="st">"vertical"</span>, <span class="kw">spread.estimate</span> <span class="kw">=</span> <span class="st">"boxplot"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>,
  <span class="kw">show.spread.at</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Threshold"</span>)</pre></body></html></div>
<p><img src="roc_analysis_files/figure-html/unnamed-chunk-24-1.png" width="75%"></p>
</div>
</div>
<div id="viper-charts" class="section level1">
<h1 class="hasAnchor">
<a href="#viper-charts" class="anchor"></a>Viper charts</h1>
<p><code>mlr</code> also supports <a href="http://viper.ijs.si/">ViperCharts</a> for plotting ROC and other performance curves. Like <code><a href="../../reference/generateThreshVsPerfData.html">generateThreshVsPerfData()</a></code> it has S3 methods for objects of class <code><a href="../../reference/Prediction.html">Prediction()</a></code>, <code><a href="../../reference/ResampleResult.html">ResampleResult()</a></code> and <code><a href="../../reference/BenchmarkResult.html">BenchmarkResult()</a></code>. Below plots for the benchmark experiment (Example 2) are generated.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">z</span> <span class="kw">=</span> <span class="fu">plotViperCharts</span>(<span class="no">bmr</span>, <span class="kw">chart</span> <span class="kw">=</span> <span class="st">"rocc"</span>, <span class="kw">browse</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">## Error in plotViperCharts(bmr, chart = "rocc", browse = FALSE): could not find function "plotViperCharts"</span></pre></body></html></div>
<p>Note that besides ROC curves you get several other plots like lift charts or cost curves. For details, see <code>plotViperCharts()</code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bernd Bischl, Michel Lang, Lars Kotthoff, Patrick Schratz, Julia Schiffner, Jakob Richter, Zachary Jones, Giuseppe Casalicchio, Mason Gallo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'e300ecafdf04fe1199e3339c825ce7d0',
    indexName: 'mlr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
